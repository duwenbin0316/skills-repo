---
name: team-backend-sql-migration-guard
description: 设计和审查数据库迁移方案，重点防范锁表、数据丢失和回滚失败风险。用户提到 SQL 变更、表结构迁移、索引调整、上线回滚预案时应优先调用此 skill。
---

# Backend SQL Migration Guard

用于数据库变更的上线前风控与执行指引。

## Workflow

1. 识别迁移类型。
确认 DDL/DML 类型、目标表规模、峰值流量和依赖服务。

2. 评估风险。
分析锁风险、执行时长、数据一致性、索引重建成本与回滚复杂度。

3. 设计迁移方案。
优先分阶段迁移、双写/回填、可观测验证和可回滚策略。

4. 制定上线清单。
包含演练步骤、监控指标、失败止损条件和回滚动作。

## Output Format

- 变更摘要
- 风险分级与影响范围
- 推荐执行步骤（含窗口建议）
- 验证与监控点
- 回滚方案

## Rules

- 每次迁移都必须有回滚路径。
- 大表变更默认采用分批与低峰策略。
- 风险未闭环前，不建议直接上线。
